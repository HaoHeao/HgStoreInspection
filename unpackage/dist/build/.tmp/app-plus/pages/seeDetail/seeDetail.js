(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/seeDetail/seeDetail"],{2704:function(e,t,n){"use strict";n.r(t);var i=n("3d57"),o=n("d3b6");for(var s in o)"default"!==s&&function(e){n.d(t,e,function(){return o[e]})}(s);n("f05b");var a=n("2877"),r=Object(a["a"])(o["default"],i["a"],i["b"],!1,null,"2243e29c",null);t["default"]=r.exports},"3d57":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c},o=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o})},"52a5":function(e,t,n){"use strict";(function(e){n("7085");i(n("66fd"));var t=i(n("2704"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},6830:function(e,t,n){"use strict";(function(e,i){function o(e,t){return r(e)||a(e,t)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function a(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done);i=!0)if(n.push(a.value),t&&n.length===t)break}catch(l){o=!0,s=l}finally{try{i||null==r["return"]||r["return"]()}finally{if(o)throw s}}return n}function r(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=getApp().$vm,u=function(){return n.e("components/haoheao-scroll/haoheao-scroll").then(n.bind(null,"efb2"))},c=function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"3406"))},d=n("65f1"),h=d.request,f={components:{haoheaoScroll:u,popup:c},data:function(){return{infoDetail:[],usernumber:e.getStorageSync("userinfo").usernumber,userid:e.getStorageSync("userinfo").userid,deptList:[],seeImgList:[],reason:"",solve:"",imgList:[],underList:[],underListArr:[],trueUnder:[],underLastIndex:"",nowUnder:[],selectIdList:[],selectInputtxt:"",btnClickReply:!0,detailLookList:[],showMoreType:1,postThereTrue:!1,status:0,upImgList:[]}},methods:{copy:function(e){l.copy(e)},powerUser:function(t){console.log(i(t," at pages\\seeDetail\\seeDetail.vue:265"));var n=e.getStorageSync("userinfo");this.status=t.status;var o=!0,s=!1,a=void 0;try{for(var r,l=t.mapinspectiondept[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var u=r.value;n.deptid==u.deptid&&(this.postThereTrue=!0)}}catch(v){s=!0,a=v}finally{try{o||null==l.return||l.return()}finally{if(s)throw a}}var c=!0,d=!1,h=void 0;try{for(var f,p=t.mapinspectionuser[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var g=f.value;n.usernumber==g.usernumber&&(this.postThereTrue=!0)}}catch(v){d=!0,h=v}finally{try{c||null==p.return||p.return()}finally{if(d)throw h}}t.usernumber==n.usernumber&&(this.postThereTrue=!0)},drawInfo:function(){var t=this,n=this;e.request({url:h.drawInfo,data:{id:n.infoDetail.inspectionlogid,usernumber:e.getStorageSync("userinfo").usernumber}}).then(function(s){var a=o(s,2),r=a[0],l=a[1];console.log(i("确认撤回巡检反回信息:",r,l," at pages\\seeDetail\\seeDetail.vue:299")),null==r&&l.data.success?(e.showToast({icon:"none",title:"成功撤回此巡检!",duration:3e3}),e.navigateBack({delta:1})):e.showToast({icon:"none",title:"撤回巡检失败,"+r.errMsg,duration:3e3}),n.showMoreType=2,t.$refs["showMore"].close()})},closeMore:function(){this.$refs["showMore"].close(),this.showMoreType=2},showMoreList:function(){this.showMoreType=2,this.moreChoice(1),this.$refs["showMore"].open()},moreChoice:function(t){var n=this;1==t&&(e.showLoading({title:"请稍后..."}),e.request({url:h.getDetailLook+n.infoDetail.inspectionlogid}).then(function(t){var s=o(t,2),a=s[0],r=s[1];e.hideLoading(),null==a&&r.data.success?(console.log(i("当前巡检记录谁查看过：",a,r," at pages\\seeDetail\\seeDetail.vue:340")),n.detailLookList=r.data.data.viewlog,n.showMoreType=2):(n.showMoreType=2,e.showToast({icon:"none",title:"查询失败,"+a.errMsg,duration:3e3}))}))},changeStatusConfirm:function(){var t=this,n=this,s=this.trueUnder;this.nowUnder;if("未选择"!=s[s.length-1].item.name){var a=[],r=!0,l=!1,u=void 0;try{for(var c,d=s[Symbol.iterator]();!(r=(c=d.next()).done);r=!0){var f=c.value;a.push(f.item.id)}}catch(g){l=!0,u=g}finally{try{r||null==d.return||d.return()}finally{if(l)throw u}}var p={inspectionlogid:this.infoDetail.inspectionlogid,inspectionid:s[s.length-1].item.id,usernumber:e.getStorageSync("userinfo").usernumber,typedesc:a,place:this.selectInputtxt};console.log(i("确认巡检单：",p," at pages\\seeDetail\\seeDetail.vue:380")),e.request({url:h.changeStatus,method:"POST",data:p}).then(function(s){var a=o(s,2),r=a[0],l=a[1];console.log(i(r,l," at pages\\seeDetail\\seeDetail.vue:387")),null==r&&l.data.success?(e.showToast({icon:"none",title:"巡检单已确认！"}),n.$refs["status"].close()):(e.showToast({icon:"none",title:l.data.errmsg}),n.$refs["status"].close()),t.getDetail(n.detail_id)})}else e.showToast({icon:"none",title:"请选择巡检归属！"})},clickUnder:function(e,t){var n=this.trueUnder,o=this.nowUnder,s={item:{name:"未选择"}};if(console.log(i(e,t,n," at pages\\seeDetail\\seeDetail.vue:409")),n=n.splice(0,t+1),!t){n=[],n.push(s),o=this.underList}n[t-1]&&(console.log(i(n[t-1]," at pages\\seeDetail\\seeDetail.vue:418")),n[t-1].children&&(o=n[t-1].children)),this.trueUnder=n,this.nowUnder=o},selectUnder:function(e,t){var n=this.trueUnder,o=this.nowUnder,s={item:{name:"未选择"}};this.underLastIndex;if(console.log(i(e,t,n,o," at pages\\seeDetail\\seeDetail.vue:435")),e.children){var a=!0,r=!1,l=void 0;try{for(var u,c=o[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;d.select=!1}}catch(h){r=!0,l=h}finally{try{a||null==c.return||c.return()}finally{if(r)throw l}}o[t].select=!0,e.children.length?(n.pop(),n.push(e),n.push(s),o=e.children):(n.pop(),n.push(e),e.item)}this.trueUnder=n,this.nowUnder=o,console.log(i(this.trueUnder,this.nowUnder," at pages\\seeDetail\\seeDetail.vue:459"))},getUnder:function(){var t=this;e.request({url:h.getUder,method:"GET"}).then(function(e){var n=o(e,2),s=n[0],a=n[1];console.log(i("归属列表",s,a," at pages\\seeDetail\\seeDetail.vue:469")),t.underList=a.data.data.menu;var r=[],l=[{item:{name:"未选择"}}],u=!0,c=!1,d=void 0;try{for(var h,f=a.data.data.menu[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;r.push(p)}}catch(s){c=!0,d=s}finally{try{u||null==f.return||f.return()}finally{if(c)throw d}}t.nowUnder=r,t.trueUnder=l})},closed:function(){this.$refs["status"].close()},getDetail:function(t){var n=this,s=this;h.getDetail({id:t,usernumber:e.getStorageSync("userinfo").usernumber}).then(function(t){var a=o(t,2),r=a[0],l=a[1];if(console.log(i("巡检单详细信息",r,l," at pages\\seeDetail\\seeDetail.vue:492")),null==r&&l.data.success){var u=l.data.data.loginspection.loginspectionquestion,c=!0,d=!1,h=void 0;try{for(var f,p=u[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var g=f.value;(new Date).getTime()-new Date(g.insertdate).getTime()>864e5?g.replyTime=!1:g.replyTime=!0}}catch(r){d=!0,h=r}finally{try{c||null==p.return||p.return()}finally{if(d)throw h}}n.infoDetail=l.data.data.loginspection,s.powerUser(l.data.data.loginspection)}else e.showToast({icon:"none",duration:2500,title:"查找失败:"+r.errMsg})})},replyTimeIs:function(e){console.log(i(e," at pages\\seeDetail\\seeDetail.vue:517"))},lookReplay:function(t){e.navigateTo({url:"../viewQuestion/viewQuestion?data="+JSON.stringify(t)+"&id="+t.inspectionlogid+"&reply_id="+t.questionid+"&postThereTrue="+this.postThereTrue+"&previs=false"})},delReply:function(t){var n=this;console.log(i(t," at pages\\seeDetail\\seeDetail.vue:528")),e.showModal({content:"您确定要撤回此回复吗?",success:function(s){s.confirm&&e.request({url:h.drawInfoReply+t.questionid}).then(function(t){var s=o(t,2),a=s[0],r=s[1];console.log(i("撤回回复返回信息：",a,r," at pages\\seeDetail\\seeDetail.vue:537")),null==a&&r.data.success,e.showToast({icon:"none",title:"撤回成功"}),n.getDetail(n.detail_id)})}})},onPullDown:function(e){this.getDetail(this.detail_id),this.getUnder(),console.log(i("下拉刷新"," at pages\\seeDetail\\seeDetail.vue:558")),setTimeout(function(){e()},1e3)},onScroll:function(e){},onLoadMore:function(e){},change:function(e){e.show||(this.reason="",this.solve="",this.imgList=[])},thatReply:function(){this.$refs["popup"].open()},thatReplyClose:function(){this.reason="",this.solve="",this.imgList=[],this.$refs["popup"].close()},addImg:function(){d.addImg(this)},delImg:function(e){d.delImg(e,this)},addReply:function(){var t=this;if(this.btnClickReply){this.btnClickReply=!1;var n=this.reason,s=this.solve,a=this.upImgList,r=this;if(""==n)return e.showToast({icon:"none",title:"请填写问题原因"}),void(this.btnClickReply=!0);var l={loginspectionquestion:{questionid:0,inspectionlogid:this.infoDetail.inspectionlogid,reason:n,remark:s,insertdate:"",userid:e.getStorageSync("userinfo").userid,username:e.getStorageSync("userinfo").username,deptid:e.getStorageSync("userinfo").deptid,deptname:e.getStorageSync("userinfo").deptname,loginspectionquestionImg:[]}},u=!0,c=!1,d=void 0;try{for(var f,p=a[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var g=f.value,v={inspectionimgid:0,questionid:0,inspectionlogid:1,imgurl:g.path};l.loginspectionquestion.loginspectionquestionImg.push(v)}}catch(y){c=!0,d=y}finally{try{u||null==p.return||p.return()}finally{if(c)throw d}}console.log(i("回复参数:",l," at pages\\seeDetail\\seeDetail.vue:647")),console.log(i("回复参数JSON:",JSON.stringify(l)," at pages\\seeDetail\\seeDetail.vue:648")),e.request({url:h.saveQiestion,method:"POST",data:l}).then(function(n){var s=o(n,2),a=s[0],l=s[1];console.log(i("回复内容返回:",l," at pages\\seeDetail\\seeDetail.vue:656")),null==a&&l.data.success?(r.getDetail(r.detail_id),r.thatReplyClose()):e.showToast({icon:"none",title:"回复失败！"}),t.btnClickReply=!0})}},seePicture:function(e,t){d.seePicture(e,t)},changeStatus:function(){0==this.infoDetail.status&&this.$refs["status"].open()}},onLoad:function(e){this.detail_id=e.id,console.log(i("巡检ID:",e," at pages\\seeDetail\\seeDetail.vue:681"))},onShow:function(){console.log(i("seeDetail onShow"," at pages\\seeDetail\\seeDetail.vue:684")),this.getUnder(),this.getDetail(this.detail_id)}};t.default=f}).call(this,n("6e42")["default"],n("0de9")["default"])},7528:function(e,t,n){},d3b6:function(e,t,n){"use strict";n.r(t);var i=n("6830"),o=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,function(){return i[e]})}(s);t["default"]=o.a},f05b:function(e,t,n){"use strict";var i=n("7528"),o=n.n(i);o.a}},[["52a5","common/runtime","common/vendor"]]]);